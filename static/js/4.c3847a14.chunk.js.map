{"version":3,"sources":["assets/audio/1.g3.ogg","assets/audio/3.a3.ogg","assets/audio/6.c4.ogg","assets/audio/9.ds4.ogg","assets/audio/12.fs4.ogg","assets/audio/15.a4.ogg","assets/audio/18.c5.ogg","assets/audio/21.ds5.ogg","assets/audio/24.fs5.ogg","assets/audio/27.a5.ogg","assets/audio/29.c6.ogg","assets/audio/30.ds6.ogg","assets/audio/31.fs6.ogg","assets/audio/32.a6.ogg","helper/translation.js","helper/useActiveNoteHandler.js","component/piano/index.js","helper/useMouseClicker.js","containers/PianoContainer.js"],"names":["translation","useActiveNoteHandler","sampler","useState","setNotes","noteRef","React","useRef","touchRef","useEffect","handleKeyDown","e","code","preventDefault","note","repeat","current","includes","triggerAttack","handleKeyUp","filter","k","triggerRelease","window","addEventListener","removeEventListener","touchNoteInfo","identifier","handleTouchStart","target","dataset","touchInfo","changedTouches","handleTouchEnd","length","changedTouch","getDataset","undefined","x","clientX","y","clientY","getPointTouch","document","elementFromPoint","handleTouchMove","prevNote","find","el","removeScroll","piano","getElementsByClassName","passive","map","t","keyOrder","Piano","low","high","setClicked","setReleased","clickedRef","releasedRef","mousePressedRef","handleMouseUp","handleMouseMove","handleMouseDown","useMouseClicker","clicked","released","activeKeys","whiteKeyInfo","number","split","lowNote","lowNumber","highNote","highNumber","lowNoteValue","indexOf","highNoteValue","numberOfWhiteKeys","blackRightNeighbour","C","D","E","F","G","A","B","idx","i","hasNeighbour","push","createKeys","createKeyPath","id","color","d","data-note","className","onContextMenu","version","baseProfile","viewBox","xmlns","preserveAspectRatio","key","toLowerCase","substr","g3b","Buffer","g3","a3b","a3","c4b","c4","ds4b","ds4","fs4b","fs4","a4b","a4","c5b","c5","ds5b","ds5","fs5b","fs5","a5b","a5","c6b","c6","ds6b","ds6","fs6b","fs6","Container","props","children","loaded","setLoaded","handle","useFullScreenHandle","Sampler","urls","baseUrl","release","onload","toDestination","onClick","enter"],"mappings":"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","file":"static/js/4.c3847a14.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/1.g3.8f81a3b9.ogg\";","export default __webpack_public_path__ + \"static/media/3.a3.9c12f360.ogg\";","export default __webpack_public_path__ + \"static/media/6.c4.2377fed6.ogg\";","export default __webpack_public_path__ + \"static/media/9.ds4.fc86c751.ogg\";","export default __webpack_public_path__ + \"static/media/12.fs4.d9071cbe.ogg\";","export default __webpack_public_path__ + \"static/media/15.a4.1f51ad50.ogg\";","export default __webpack_public_path__ + \"static/media/18.c5.350a2ba1.ogg\";","export default __webpack_public_path__ + \"static/media/21.ds5.929d4e7b.ogg\";","export default __webpack_public_path__ + \"static/media/24.fs5.1fc5847e.ogg\";","export default __webpack_public_path__ + \"static/media/27.a5.caa01068.ogg\";","export default __webpack_public_path__ + \"static/media/29.c6.ad686e2c.ogg\";","export default __webpack_public_path__ + \"static/media/30.ds6.94cc53fa.ogg\";","export default __webpack_public_path__ + \"static/media/31.fs6.b6721791.ogg\";","export default __webpack_public_path__ + \"static/media/32.a6.c28f6973.ogg\";","const translation = {\r\n    'KeyZ': 'G1',\r\n    'KeyX': 'A1',\r\n    'KeyC': 'B1',\r\n    'KeyV': 'C2',\r\n    'KeyB': 'D2',\r\n    'KeyN': 'E2',\r\n    'KeyM': 'F2',\r\n    'Comma': 'G2',\r\n    'Period': 'A2',\r\n    'Slash': 'B2',\r\n    'KeyQ': 'C3',\r\n    'KeyW': 'D3',\r\n    'KeyE': 'E3',\r\n    'KeyR': 'F3',\r\n    'KeyT': 'G3',\r\n    'KeyY': 'A3',\r\n    'KeyU': 'B3',\r\n    'KeyI': 'C4',\r\n    'KeyO': 'D4',\r\n    'KeyP': 'E4',\r\n    'BracketLeft': 'E4',\r\n    'BracketRight': 'E4',\r\n    'KeyS': 'G#1',\r\n    'KeyD': 'A#1',\r\n    'KeyG': 'C#2',\r\n    'KeyH': 'D#2',\r\n    'KeyK': 'F#2',\r\n    'KeyL': 'G#2',\r\n    'Semicolon': 'A#2',\r\n    'Digit2': 'C#3',\r\n    'Digit3': 'D#3',\r\n    'Digit5': 'F#3',\r\n    'Digit6': 'G#3',\r\n    'Digit7': 'A#3',\r\n    'Digit9': 'C#4',\r\n    'Digit0': 'D#4',\r\n}\r\nexport default translation;","import React, { useEffect, useState } from 'react';\r\nimport translation from './translation'\r\n\r\n// This returns the pressed notes so the class active can get added to pressed keys. It also plays the notes.\r\nconst useActiveNoteHandler = (sampler) => {\r\n  const [, setNotes] = useState([])\r\n  const noteRef = React.useRef([])\r\n  const touchRef = React.useRef([])\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      // This is to disable the quickfind on firefox\r\n      if (e.code === 'Slash') {\r\n        e.preventDefault();\r\n      }\r\n      const note = translation[e.code]\r\n      if (!note || e.repeat || noteRef.current.includes(note)) return;\r\n      // I have to do it like this. If I use usestate here instead of ref it will remove and add the eventlisteners every time i click. This means if I release two keys at the same time the eventlistener for one of them might get removed by releasing the other key, and the website wont register the release of the key. I only use setNotes to trigger a rerender, it doesn't actually get used for anything else. \r\n      noteRef.current = [...noteRef.current, note]\r\n      setNotes(noteRef.current)\r\n      sampler.triggerAttack(note)\r\n    }\r\n    const handleKeyUp = ({ code }) => {\r\n      const note = translation[code]\r\n      noteRef.current = noteRef.current.filter(k => k !== note)\r\n      setNotes(noteRef.current)\r\n      sampler.triggerRelease(note)\r\n    }\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    window.addEventListener('keyup', handleKeyUp);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n      window.removeEventListener('keyup', handleKeyUp);\r\n    };\r\n  }, [sampler])\r\n  useEffect(() => {\r\n    function touchNoteInfo({ identifier }, note) {\r\n      return { note, identifier }\r\n    }\r\n    function getPointTouch(changedTouch) {\r\n      const x = changedTouch.clientX\r\n      const y = changedTouch.clientY\r\n      return { x, y }\r\n    }\r\n    const handleTouchStart = (e) => {\r\n      e.preventDefault()\r\n      const { note } = e.target.dataset\r\n      const touchInfo = touchNoteInfo(e.changedTouches[0], note)\r\n      touchRef.current = [...touchRef.current, touchInfo]\r\n      setNotes(touchRef.current);\r\n      sampler.triggerAttack(note)\r\n    }\r\n\r\n    const handleTouchEnd = (e) => {\r\n      // Prevent default stops the clicking of buttons, like keybinding and enter fullscreen. If noteRef is larger than 0 I am currently clicking piano buttons, and then I want to stop default.\r\n      if (touchRef.current.length > 0) {\r\n        e.preventDefault()\r\n      }\r\n      for (const changedTouch of e.changedTouches) {\r\n        const dataset = getDataset(changedTouch)\r\n        if (dataset === undefined) return;\r\n        const note = touchNoteInfo(changedTouch, dataset.note)\r\n        touchRef.current = touchRef.current.filter(k => k.note !== note.note)\r\n        setNotes(...touchRef.current)\r\n        sampler.triggerRelease(note.note)\r\n\r\n      }\r\n    }\r\n    // Handlemove in a similar vein to this https://developer.mozilla.org/en-US/docs/Web/API/Touch_events under handleMove\r\n    const getDataset = (changedTouch) => {\r\n      const { x, y } = getPointTouch(changedTouch)\r\n      const dataset = document.elementFromPoint(x, y)?.dataset\r\n      return dataset\r\n    }\r\n    const handleTouchMove = (e) => {\r\n      for (const changedTouch of e.changedTouches) {\r\n\r\n        const dataset = getDataset(changedTouch)\r\n        if (dataset === undefined) return;\r\n        const note = touchNoteInfo(changedTouch, dataset.note)\r\n        const prevNote = touchRef.current.find(el => el.identifier === note.identifier) || { note: undefined, identifier: note.identifier };\r\n        if (note.note !== prevNote.note) {\r\n          touchRef.current = touchRef.current.filter(k => k.note !== prevNote.note)\r\n          touchRef.current = [...touchRef.current, note]\r\n          if (note.note != null) {\r\n            sampler.triggerAttack(note.note)\r\n          }\r\n          if (prevNote.note != null) {\r\n            sampler.triggerRelease(prevNote.note)\r\n          }\r\n          setNotes(touchRef.current)\r\n        }\r\n      }\r\n    }\r\n\r\n    const removeScroll = (e) => {\r\n      e.preventDefault();\r\n    }\r\n    const piano = document.getElementsByClassName('piano')[0]\r\n    // I need to add eventlistener here, instead of inline in element, because I need to set it to passive, so I can prevent default.\r\n    piano.addEventListener('touchstart', handleTouchStart, { passive: false });\r\n    document.addEventListener('touchend', handleTouchEnd);\r\n    document.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n    piano.addEventListener('touchmove', removeScroll, { passive: false });\r\n    return () => {\r\n      piano.removeEventListener('touchstart', handleTouchStart, { passive: false });\r\n      document.removeEventListener('touchend', handleTouchEnd);\r\n      document.removeEventListener('touchmove', handleTouchMove, { passive: false });\r\n      piano.addEventListener('touchmove', removeScroll, { passive: false });\r\n    }\r\n  }, [sampler])\r\n  return [...touchRef.current.map(t => t.note), ...noteRef.current]\r\n}\r\nexport default useActiveNoteHandler;","import React, { useEffect } from 'react'\r\nimport useActiveNoteHandler from '../../helper/useActiveNoteHandler';\r\nimport useMouseClicker from '../../helper/useMouseClicker';\r\n\r\nconst keyOrder = [\r\n  'C',\r\n  'D',\r\n  'E',\r\n  'F',\r\n  'G',\r\n  'A',\r\n  'B',\r\n]\r\n\r\nconst Piano = ({ sampler, low, high }) => {\r\n  const [clicked, released] = useMouseClicker();\r\n  const activeKeys = useActiveNoteHandler(sampler)\r\n  const whiteKeyInfo = createKeys(low, high)\r\n  // The path is created here, if it is the first or last white key the left respectively the right corner should be rounded.\r\n\r\n\r\n  useEffect(() => {\r\n    if (clicked == null) return\r\n    sampler.triggerAttack(clicked)\r\n  }, [sampler, clicked])\r\n  useEffect(() => {\r\n    if (released == null) return\r\n    sampler.triggerRelease(released)\r\n  }, [sampler, released])\r\n\r\n\r\n  function createWhiteKeys() {\r\n    return whiteKeyInfo.map((key, i) => {\r\n      const id = key.note.toLowerCase()\r\n      if (i === 0) {\r\n        return createKeyPath(id, key.note, 'white', 'm 0 0 v 107 a 3 3 0 0 0 3 3 h 27 v -110 z')\r\n      } else if (i === whiteKeyInfo.length - 1) {\r\n        return createKeyPath(id, key.note, 'white', `m ${i * 30} 0 v 110 h 27 a 3 3 0 0 0 3 -3 v -107 z `)\r\n      } else {\r\n        return createKeyPath(id, key.note, 'white', `m ${i * 30} 0 v 110 h 30 v -110 z`)\r\n      }\r\n    })\r\n  }\r\n  function createKeyPath(id, note, color, d) {\r\n    return <path\r\n      key={id} id={id}\r\n      data-note={note}\r\n      className={`${color}-key piano-key ${activeKeys.includes(note) || clicked === note ? 'active' : ''}`}\r\n      d={d}\r\n      onContextMenu={(e) => e.preventDefault()}\r\n    />\r\n  }\r\n  // Maps through all the white keys. If the white key should have a neighbour it creates a black key, unless it is the last white key. If it shouldnt have a neighbour it returns null.\r\n  function createBlackKeys() {\r\n    return whiteKeyInfo.map((key, i) => {\r\n      const id = (key.note.substr(0, 1) + 's' + key.note.substr(1)).toLowerCase()\r\n      const note = key.note.substr(0, 1) + '#' + key.note.substr(1)\r\n      if (i === whiteKeyInfo.length - 1) {\r\n        return null;\r\n      }\r\n      else if (key.hasNeighbour) {\r\n        return createKeyPath(id, note, 'black', `m ${18 + 30 * i} 0 v 63 a 2 2 0 0 0 2 2 h 18 a 2 2 0 0 0 2 -2 v -63 z`)\r\n\r\n      }\r\n      else {\r\n        return null\r\n      }\r\n    })\r\n  }\r\n  return (\r\n    <svg version=\"1.1\" baseProfile=\"full\" className=\"piano\" viewBox={`-1 -1 ${whiteKeyInfo.length * 30 + 2} 112`} xmlns=\"http://www.w3.org/2000/svg\" preserveAspectRatio=\"none\">\r\n      {createWhiteKeys()}\r\n      {createBlackKeys()}\r\n    </svg>\r\n  )\r\n}\r\n\r\n// This creates an array with all white keys, also containing info if the key has a black key next to it.\r\nfunction createKeys(low, high) {\r\n  const number = numberOfWhiteKeys(low, high)\r\n  const blackRightNeighbour = {\r\n    C: true,\r\n    D: true,\r\n    E: false,\r\n    F: true,\r\n    G: true,\r\n    A: true,\r\n    B: false,\r\n  }\r\n\r\n  let [lowNote, lowNumber] = low.split(\"\")\r\n  let idx = keyOrder.indexOf(lowNote);\r\n  let whiteKeyInfo = []\r\n  for (let i = 0; i < number; i++) {\r\n    if (idx === 0 && i > 0) {\r\n      lowNumber++\r\n    }\r\n    const hasNeighbour = blackRightNeighbour[keyOrder[idx]]\r\n    whiteKeyInfo.push({ note: (keyOrder[idx] + lowNumber), hasNeighbour })\r\n    idx = idx > 5 ? 0 : idx + 1\r\n  }\r\n  return whiteKeyInfo;\r\n}\r\n\r\nfunction numberOfWhiteKeys(low, high) {\r\n  const [lowNote, lowNumber] = low.split(\"\")\r\n  const [highNote, highNumber] = high.split(\"\")\r\n  const lowNoteValue = keyOrder.indexOf(lowNote)\r\n  const highNoteValue = keyOrder.indexOf(highNote)\r\n  const noteValue = highNoteValue - lowNoteValue + 1\r\n  const octaveValue = highNumber - lowNumber;\r\n  return octaveValue * 7 + noteValue;\r\n}\r\nexport default Piano\r\n","import React, { useEffect, useState } from 'react';\r\nexport default function useMouseClicker(sampler) {\r\n    const [, setClicked] = useState(null)\r\n    const [, setReleased] = useState(null)\r\n    const clickedRef = React.useRef(null)\r\n    const releasedRef = React.useRef(null)\r\n    const mousePressedRef = React.useRef(false)\r\n    useEffect(() => {\r\n        const handleMouseUp = (e) => {\r\n            mousePressedRef.current = false;\r\n            if(e.target.dataset === undefined) return\r\n            const { note } = e.target.dataset\r\n            clickedRef.current = null;\r\n            releasedRef.current = note;\r\n            setReleased(note)\r\n            setClicked(null)\r\n        }\r\n\r\n        const handleMouseMove = (e) => {\r\n            if (mousePressedRef.current === true) {\r\n                if(e.target.dataset === undefined) return\r\n                const { note } = e.target.dataset\r\n                const prevNote = clickedRef.current;\r\n                if(note !== prevNote){\r\n                    clickedRef.current = note;\r\n                    releasedRef.current = prevNote;\r\n                    setClicked(note)\r\n                    setReleased(prevNote)\r\n                }\r\n            }\r\n        }\r\n        const handleMouseDown = (e) => {\r\n            mousePressedRef.current = true;\r\n            const { note } = e.target.dataset\r\n            if (!note) return\r\n            clickedRef.current = note;\r\n            releasedRef.current = null;\r\n            setClicked(note)\r\n            setReleased(null)\r\n        }\r\n\r\n        // Here instead of in path because I mouse sometimes get released not over the clicked note.\r\n        window.addEventListener('mousedown', handleMouseDown);\r\n        window.addEventListener('mousemove', handleMouseMove);\r\n        window.addEventListener('mouseup', handleMouseUp);\r\n        return () => {\r\n            window.removeEventListener('mousedown', handleMouseDown);\r\n            window.removeEventListener('mousemove', handleMouseMove);\r\n            window.removeEventListener('mouseup', handleMouseUp);\r\n        }\r\n    }, [sampler])\r\n    return [clickedRef.current, releasedRef.current]\r\n}","import React, { useState } from 'react'\r\nimport { Sampler, Buffer } from 'tone'\r\nimport { g3, a3, c4, ds4, fs4, a4, c5, ds5, fs5, a5, c6, ds6, fs6 } from '../assets/audio'\r\nimport { FullScreen, useFullScreenHandle } from \"react-full-screen\";\r\nimport Piano from '../component/piano'\r\nconst g3b = new Buffer(g3)\r\nconst a3b = new Buffer(a3)\r\nconst c4b = new Buffer(c4)\r\nconst ds4b = new Buffer(ds4)\r\nconst fs4b = new Buffer(fs4)\r\nconst a4b = new Buffer(a4)\r\nconst c5b = new Buffer(c5)\r\nconst ds5b = new Buffer(ds5)\r\n\r\nconst fs5b = new Buffer(fs5)\r\nconst a5b = new Buffer(a5)\r\nconst c6b = new Buffer(c6)\r\nconst ds6b = new Buffer(ds6)\r\nconst fs6b = new Buffer(fs6)\r\n\r\nconst Container = ({ high, low, children, ...props }) => {\r\n  const [loaded, setLoaded] = useState(false)\r\n  const handle = useFullScreenHandle();\r\n  const sampler = new Sampler({\r\n    urls: {\r\n      \"G1\": g3b,\r\n      \"A1\": a3b,\r\n      \"C2\": c4b,\r\n      \"D#2\": ds4b,\r\n      \"F#2\": fs4b,\r\n      \"A2\": a4b,\r\n      \"C3\": c5b,\r\n      \"D#3\": ds5b,\r\n      \"F#3\": fs5b,\r\n      \"A3\": a5b,\r\n      \"C4\": c6b,\r\n      \"D#4\": ds6b,\r\n      \"F#4\": fs6b,\r\n    },\r\n    baseUrl: \"../../assets/audio\",\r\n    release: 1,\r\n    onload: () => {\r\n      setLoaded(true)\r\n    }\r\n  }).toDestination();\r\n\r\n  const handleClick = () => {\r\n    handle.enter()\r\n  }\r\n\r\n  return (\r\n    <div className=\"piano-container\" {...props}>\r\n      <FullScreen handle={handle}>\r\n        {loaded ?\r\n          <Piano sampler={sampler} low={low} high={high} />\r\n          : null}\r\n      </FullScreen>\r\n      <button id=\"fullscreen-btn\" onClick={handleClick}>\r\n        Enter fullscreen\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Container\r\n"],"sourceRoot":""}